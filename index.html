client_handle_input = function() {
    
//....

            //Update what sequence we are on now
        this.input_seq += 1;

            //Store the input state as a snapshot of what happened.
        this.players.self.inputs.push({
            inputs : input,
            time : this.local_time.fixed(3),
            seq : this.input_seq
        });

            //Send the packet of information to the server.
            //The input packets are labelled with an 'i' in front.
        var server_packet = 'i.';
            server_packet += input.join('-') + '.';
            server_packet += this.local_time.toFixed(3).replace('.','-') + '.';
            server_packet += this.input_seq;
            
            //Go
        this.socket.send(  server_packet  );

//....

}


//In the update loop and when we recieve a message from the server
//we immediately set the client position, as the server has final say,
//but then we apply any input the server has not acknowledged yet, keeping our position consistent

client_process_net_prediction_correction = function() {
//....

        //The most recent server update
    var latest_server_data = this.server_updates[this.server_updates.length-1];

    var my_last_input_on_server = this.players.self.host ? 
                                    latest_server_data.his : 
                                        latest_server_data.cis;

        //If the server has sent us a 'host input sequence' or 'client input sequence' state 
    if(my_last_input_on_server) {

            //The last input sequence index in my local input list
        var lastinputseq_index = -1;

            //Find this input in the list, and store the index of that input
        for(var i = 0; i < this.players.self.inputs.length; ++i) {

            if(this.players.self.inputs[i].seq == my_last_input_on_server) {
                lastinputseq_index = i;
                break;
            }

        }

            //Now we can crop the list of any updates we have already processed
        if(lastinputseq_index != -1) {

            //since we have now gotten an acknowledgement from the server that our inputs here have been accepted
            //and we now predict from the last known position instead of wherever we were.

                //remove the rest of the inputs we have confirmed on the server
            var number_to_clear = Math.abs(lastinputseq_index + 1));
                //Then clear the past ones out
            this.players.self.inputs.splice(0, number_to_clear);

                //The player is now located at the new server position, authoritive server
            this.players.self.cur_state.pos = this.pos(my_server_pos);
            this.players.self.last_input_seq = lastinputseq_index;
            
                //Now we reapply all the inputs that we have locally that
                //the server hasn't yet confirmed. This will 'keep' our position the same,
                //but also confirm the server position at the same time.
            this.client_update_physics();
            this.client_update_local_position();

        } // if(lastinputseq_index != -1)
    } //if my_last_input_on_server


//....
}
